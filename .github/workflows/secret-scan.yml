name: "Secret Scanning"

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  secret-scan:
    name: Scan for secrets
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Install git-secrets
        run: |
          git clone https://github.com/awslabs/git-secrets.git
          cd git-secrets && sudo make install

      - name: Register patterns
        run: |
          git secrets --register-aws
          # Anthropic API keys
          git secrets --add 'sk-ant-api[a-zA-Z0-9_-]+'
          # Google API keys
          git secrets --add 'AIzaSy[a-zA-Z0-9_-]+'
          # Google OAuth client secrets
          git secrets --add 'GOCSPX-[a-zA-Z0-9_-]+'
          # OpenRouter keys
          git secrets --add 'sk-or-v1-[a-zA-Z0-9_-]+'
          # Telegram bot tokens
          git secrets --add '[0-9]+:AA[a-zA-Z0-9_-]{33}'
          # Google refresh tokens
          git secrets --add '1//[a-zA-Z0-9_-]{40,}'

      - name: Scan repository
        run: git secrets --scan
